/*! komponentor v1.0.0
 * A jQuery plugin to create modular web apps
 * (c) 2025 
 * Released under the MIT License
 */
!function(t){const n="No URL provided",e="Failed to initiate component due to failed ajax request",o=(...t)=>{komponentor.options.debug&&console.log("[Komponentor]",...t)};async function r(n){const e={ready:!1,$el:null,loading:()=>{},find:function(t){return this.$el.find(t)},addListener:function(t,n){this.listeners[t].push(n)},listeners:{ready:[]}};if(delete n.komponent,Object.assign(e,n),e.$el&&e.$el.data("komponent"))return n.$el.data("komponent");const r=t("<div>").html("\n        <div style='position: absolute; top:50%; transform: translate(-50%, -50%); left:50%'>\n            Se incarca\n        </div>\n    ").addClass("komponent-overlay").css({border:"dashed 1px silver",background:"#eee",position:"absolute",zIndex:1e6,textAlign:"center"}).clone().width(t(e.$el).width()).height(t(e.$el).height()).insertBefore(e.$el),l=r.parent();l.length&&"BODY"===l[0].tagName&&r.css("width","100%").css("height","100%");try{const l=await i(e);try{if(!n.bind||!t(n.bind).data("komponent"))return o("renderKomponent no bind",e),e.init_result=a(e,l),r.remove(),e;const i=t(n.bind).data("komponent");return i.ready?(o("renderKomponent bind ready",e),e.data=i,e.init_result=a(e,l),r.remove(),e):(o("Add listener to",i),e.loading(),i.addListener("ready",(t=>{o("renderKomponent on bind ready",e),n.data=t,Object.assign(e,n),e.init_result=a(e,l),r.remove(),o("Component loaded",e)})),e)}catch(t){e.init_result=a(e,l),r.remove(),console.error("Error in Komponent",t)}}catch(t){return r.remove(),e.$el.html("Could not load component "+e.url),o("Error in Komponent",t),e}}async function a(n,e){let o=t("<div>").appendTo("body").append(e);o.find("script").each(((n,e)=>{t(e).remove()}));let r,a=o.children().remove();o.remove(),console.log(a,a[0].tagName,a.children()),"TEMPLATE"===a[0].tagName&&(a=t(a[0].content)),"function"==typeof init_komponent?(r=init_komponent.bind(n),init_komponent=null,delete init_komponent):r=async function(){},n.$el&&a.length&&(n.replace?(n.$el.replaceWith(a),n.$el=a):n.$el.empty().append(a)),n.$el||(n.$el=a),setTimeout((()=>n.$el.prev(".komponent-overlay").remove()),100),n.$el.data("komponent",n).attr("is","komponent").find("*").data("komponent",n);try{await r(n,n.data?n.data:null),n.listeners.ready.forEach((t=>t(n))),n.ready=!0}catch(t){console.error("Error in initKomponent",t)}(void 0===n.autoload||n.autoload)&&(n.find("[is=komponent]").each(((n,e)=>t(e).komponent())),n.find("komponent").each(((n,e)=>t(e).komponent())))}async function i(t){if(!t.url)throw new Error(n);try{const n=await fetch(t.url);if(!n.ok)throw{reason:e,status:n.status,statusText:n.statusText,request:t};return await n.text()}catch(n){throw{reason:e,error:n,request:t}}}window.komponentor={components:{},path:null,options:{debug:!0}},t.fn.komponent=function(t){void 0===t&&(t={}),"string"==typeof t&&(t={url:t});let n=this.data();void 0===n&&(n={}),Object.assign(n,t),n.$el=this,n.url||console.log("options.url",n),n.data=void 0===t.data?{}:t.data;let e=n.url.split("|");n.url=e.shift(),e.forEach((t=>{let e=t.split("=");n.data[e[0]]=void 0===e[1]?null:e[1]}));try{return r(n)}catch(t){return o("Failed to load Komponent: ",t),void n.$el.html("<div>Failed to load Komponent <b>"+n.url+"</b></div>")}},String.prototype.hashCode=function(){let t,n,e=0;if(0===this.length)return e;for(t=0;t<this.length;t++)n=this.charCodeAt(t),e=(e<<5)-e+n,e|=0;return Math.abs(e)},window.komponentor.intent=function(t){let n={data:{}},e={url:function(t){return n.url=t,this},data:function(t,e){return"object"==typeof t?(Object.assign(n.data,t),this):(n.data[t]=e,this)},send:function(t){t&&e.data(t);try{return r(n)}catch(t){console.error("Error in Komponent",t)}}};return t&&e.url(t),e},komponentor.sendIntent=function(t){i(t).then((function(n){n&&n.hasOwnProperty("exec")&&n.exec(t.data)})).catch((function(n){console.log("could not load",n,t)})).finally((()=>{$overlay.remove()}))},komponentor.loadKomponents=function(n){return async function(n){t(n).find("[is=komponent]").each((async function(){await t(this).komponent()}))}(n)}}(jQuery);
//# sourceMappingURL=komponentor.min.js.map
