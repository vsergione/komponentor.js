{
  "version": 3,
  "sources": ["../src/ksimpleviews.js"],
  "sourcesContent": ["/**\n * KSimpleViews - KModel + KView with template rendering.\n * Requires: jQuery.\n * Optional: Handlebars (window.Handlebars) for full syntax; otherwise uses built-in {{key}} / {{key.sub}} fallback.\n * No Komponentor dependency.\n */\n(function (root, $) {\n    \"use strict\";\n\n    if (!$ || typeof $.fn !== \"object\") {\n        throw new Error(\"KSimpleViews requires jQuery\");\n    }\n\n    const Handlebars = root.Handlebars;\n\n    /** Fallback when Handlebars is missing: {{key}} and {{key.sub}} only. */\n    function defaultCompile(html) {\n        return function (data) {\n            if (data == null) data = {};\n            return String(html).replace(/\\{\\{(\\w+(?:\\.\\w+)*)\\}\\}/g, (_, path) => {\n                const parts = path.split(\".\");\n                let v = data;\n                for (const p of parts) {\n                    v = v != null && typeof v === \"object\" ? v[p] : undefined;\n                }\n                return v != null ? String(v) : \"\";\n            });\n        };\n    }\n\n    function compileTemplate(html) {\n        if (Handlebars && typeof Handlebars.compile === \"function\") {\n            return Handlebars.compile(html);\n        }\n        return defaultCompile(html);\n    }\n    class KView {\n        #compiled;\n        #model;\n        #el;\n        #destroyed = false;\n\n        /**\n         * @param {jQuery|HTMLElement|string} el - Single element: mount point; its outerHTML is the template. Replaced by the rendered root on first render.\n         * @param {KModel} model - KModel instance.\n         * @param {Object} [lifecycle] - Optional object with onDestroy(fn); if provided, view.destroy() is called when lifecycle is torn down.\n         * @throws {Error} If el is not a single node.\n         */\n        constructor(el, lifecycle) {\n            const $el = $(el);\n            if ($el.length !== 1) {\n                throw new Error(\"KView: el must be a single node (got \" + $el.length + \")\");\n            }\n            this.#el = $el;\n            this.#compiled = compileTemplate($el[0].outerHTML);\n\n            if (lifecycle && typeof lifecycle.onDestroy === \"function\") {\n                lifecycle.onDestroy(() => this.destroy());\n            }\n        }\n\n        render() {\n            const existingData = this.#el.data(\"komponent\") || null;\n\n            if (this.#destroyed) return;\n            try {\n                const html = this.#compiled(this.#model.props);\n                const $content = $(html);\n\n                this.#el.replaceWith($content);\n                this.#el = $content;\n                this.#el.data(\"model\", this.#model).attr(\"is\",\"kview\");\n//                this.#el.find(\"*\").data(\"model\", this.#model);\n            } catch (e) {\n                const $error = $(\"<div>Error in KView.render</div>\");\n                this.#el.replaceWith($error);\n                this.#el = $error;\n                console.error(\"Error in KView.render\", e);\n            }\n\n            if (existingData != null) {\n                this.#el.data(\"komponent\", existingData);\n            }\n        }\n\n        /**\n         * Current root element(s) in the DOM. Before first render, returns the mount element; after, the rendered root.\n         * @returns {jQuery}\n         */\n        getRoot() {\n            return this.#el || $();\n        }\n\n        setModel(model) {\n            if (this.#destroyed) return;\n            this.#model = model;\n            this.render();\n        }\n\n        /**\n         * Unbind this view from the model and mark as destroyed. Removes the view root from the DOM.\n         */\n        destroy() {\n            if (this.#destroyed) return;\n            this.#destroyed = true;\n            if (this.#model && typeof this.#model.unbindView === \"function\") {\n                this.#model.unbindView(this);\n            }\n            if (this.#el && this.#el.length) this.#el.remove();\n            this.#model = null;\n            this.#el = null;\n        }\n    }\n\n    /**\n     * KModel - Observable data for use with KView.\n     * data / props, update(name, value), bindView(view), unbindView(view), render(), destroy().\n     * Events: \"change\" (after update or data set), \"view:bind\", \"view:unbind\", \"destroy\".\n     */\n    class KModel {\n        views = [];\n        #data = {};\n        #destroyed = false;\n        #listeners = new Map(); // event -> [{ fn, ctx }]\n\n        get props() {\n            return this.#data;\n        }\n\n        get data() {\n            return this.#data;\n        }\n\n        set data(val) {\n            if (this.#destroyed) return;\n            this.#data = val;\n            this._trigger(\"change\", { data: this.#data });\n            this.render();\n        }\n\n        constructor(data) {\n            this.#data = data || {};\n        }\n\n        /**\n         * Subscribe to an event. Events: \"change\", \"view:bind\", \"view:unbind\", \"destroy\".\n         * @param {string} event - Event name.\n         * @param {function} fn - Callback(payload).\n         * @param {*} [ctx] - Optional this for fn.\n         * @returns {KModel} this\n         */\n        on(event, fn, ctx) {\n            if (typeof fn !== \"function\") return this;\n            const arr = this.#listeners.get(event) || [];\n            arr.push({ fn, ctx: ctx || null });\n            this.#listeners.set(event, arr);\n            return this;\n        }\n\n        /**\n         * Unsubscribe from an event.\n         * @param {string} event - Event name.\n         * @param {function} fn - Same function reference as passed to on().\n         * @param {*} [ctx] - Optional context (must match on() to remove).\n         * @returns {KModel} this\n         */\n        off(event, fn, ctx) {\n            const arr = this.#listeners.get(event);\n            if (!arr) return this;\n            this.#listeners.set(\n                event,\n                arr.filter((l) => !(l.fn === fn && (ctx == null || l.ctx === ctx)))\n            );\n            return this;\n        }\n\n        /**\n         * Emit an event to all listeners.\n         * @param {string} event - Event name.\n         * @param {*} payload - Data passed to listeners.\n         * @returns {KModel} this\n         */\n        trigger(event, payload) {\n            const arr = this.#listeners.get(event);\n            if (!arr || !arr.length) return this;\n            for (const l of arr.slice()) {\n                try {\n                    l.fn.call(l.ctx || null, payload);\n                } catch (e) {\n                    console.error(\"KModel event handler error\", event, e);\n                }\n            }\n            return this;\n        }\n\n        _trigger(event, payload) {\n            this.trigger(event, payload);\n        }\n\n        update(name, val) {\n            if (this.#destroyed) return;\n            this.#data[name] = val;\n            this._trigger(\"change\", { name, value: val });\n            this.render();\n        }\n\n        bindView(view) {\n            if (this.#destroyed) return;\n            if (this.views.indexOf(view) === -1) {\n                this.views.push(view);\n                this._trigger(\"view:bind\", { view });\n            }\n            view.setModel(this);\n        }\n\n        unbindView(view) {\n            const i = this.views.indexOf(view);\n            if (i !== -1) {\n                this.views.splice(i, 1);\n                this._trigger(\"view:unbind\", { view });\n            }\n        }\n\n        unbindAllViews() {\n            this.views.length = 0;\n        }\n\n        render() {\n            if (this.#destroyed) return;\n            this.views.forEach((v) => v.render());\n        }\n\n        destroy() {\n            if (this.#destroyed) return;\n            this.#destroyed = true;\n            this._trigger(\"destroy\", { model: this });\n            this.views.forEach((v) => {\n                if (v && typeof v.destroy === \"function\") v.destroy();\n            });\n            this.views.length = 0;\n            this.#listeners.clear();\n            this.#data = {};\n        }\n    }\n\n    root.KModel = KModel;\n    root.KView = KView;\n    root.getKModel = function(el) {\n        return $(el).parents(\"[is=kview]\").data(\"model\");\n    }\n})(typeof window !== \"undefined\" ? window : globalThis, typeof window !== \"undefined\" && window.jQuery);\n"],
  "mappings": "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",
  "names": ["_destroyed"]
}
