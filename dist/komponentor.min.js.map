{"version":3,"sources":["komponentor.js"],"names":["global","$","jQuery","KEY_INST","KEY_LOCK","isPlainObject","x","constructor","Object","normalizeHost","host","Error","el","document","querySelector","Element","getInst","unlockHost","inst","parseSpec","specText","out","url","data","parts","String","split","shift","forEach","p","i","indexOf","k","slice","v","getDataAttributesFromElement","markerAttr","dataset","excludeKey","attrName","toLowerCase","startsWith","replace","_","c","toUpperCase","key","EventBus","this","_map","Map","on","event","fn","ctx","arr","get","push","set","off","filter","l","emit","payload","thisArg","length","call","e","clear","Context","owner","manager","id","prefix","Math","random","toString","uid","parent","children","ready","_destroyed","_state","_bus","_destroyers","_req","token","ctrl","state","trigger","emitUp","emitRoot","root","_rootCtx","onDestroy","requestAbort","abort","requestText","fetchOpts","t","AbortController","res","fetch","assign","signal","ok","status","statusText","text","destroy","kids","ch","ds","reverse","Komponent","opts","hostEl","$host","_normalizeOpts","_scanned","existing","config","debug","setInst","Intent","clearInst","find","selector","findAll","Array","from","querySelectorAll","mount","overlay","show","_resolveUrl","htmlText","fetchOptions","fragment","init","_parseHtml","_renderIntoHost","autoload","scan","replaceExisting","replaceExistingChildren","_renderError","log","hide","remount","innerHTML","splice","_normalizeIntentOpts","run","cloneNode","console","HashRouter","_started","_handler","routes","outlet","notFound","_compile","pattern","keys","rx","regex","RegExp","configure","isArray","r","add","path","entries","pathPattern","match","hash","m","exec","params","route","start","location","outletEl","addEventListener","stop","removeEventListener","navigate","Komponentor","baseUrl","overlayClass","overlayHtml","errorHtml","err","_root","router","_overlayShow","_overlayHide","args","o","includes","parsed","urlOrOpts","fromUrl","komponent","createElement","scripts","content","code","map","s","textContent","join","remove","trim","maybe","Function","appendChild","_overlayEl","parentNode","ov","className","style","position","minHeight","border","background","zIndex","insertBefore","firstChild","removeChild","container","body","attr","nodes","node","getAttribute","dataFromAttrs","intent","_url","_data","objOrKey","val","send","runIntent","K","komponentor","window"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA8BA,SAAWA,GACP,aAEA,MAAMC,EAAID,EAAOE,QAAU,KAKrBC,EAAW,kBACXC,EAAW,kBAEjB,SAASC,EAAcC,GACrB,OAAOA,GAAkB,iBAANA,GAAkBA,EAAEC,cAAgBC,MACzD,CAWA,SAASC,EAAcC,GACrB,IAAKA,EAAM,MAAM,IAAIC,MAAM,gBAC3B,GAAoB,iBAATD,EAAmB,CAC5B,MAAME,EAAKC,SAASC,cAAcJ,GAClC,IAAKE,EAAI,MAAM,IAAID,MAAM,mBAAmBD,KAC5C,OAAOE,CACT,CACA,GAAIX,GAAKS,aAAgBT,EAAG,OAAOS,EAAK,GACxC,GAAIA,aAAgBK,QAAS,OAAOL,EACpC,MAAM,IAAIC,MAAM,oBAClB,CAEA,SAASK,EAAQJ,GACf,OAAOA,GAAKA,EAAGT,IAAoB,IACrC,CAcA,SAASc,EAAWL,EAAIM,GACjBN,IACDA,EAAGR,KAAcc,GAAgB,MAARA,IAAcN,EAAGR,GAAY,MAC5D,CAEA,SAASe,EAAUC,GAEjB,MAAMC,EAAM,CAAEC,IAAK,GAAIC,KAAM,CAAC,GAC9B,IAAKH,EAAU,OAAOC,EACtB,MAAMG,EAAQC,OAAOL,GAAUM,MAAM,KAarC,OAZAL,EAAIC,IAAME,EAAMG,SAAW,GAC3BH,EAAMI,SAASC,IACb,IAAKA,EAAG,OACR,MAAMC,EAAID,EAAEE,QAAQ,KACpB,IAAW,IAAPD,EACFT,EAAIE,KAAKM,GAAK,SACT,CACL,MAAMG,EAAIH,EAAEI,MAAM,EAAGH,GACfI,EAAIL,EAAEI,MAAMH,EAAI,GACtBT,EAAIE,KAAKS,GAAW,KAANE,EAAW,GAAKA,CAChC,KAEKb,CACT,CAWA,SAASc,EAA6BvB,EAAIwB,GACxC,IAAKxB,IAAOA,EAAGyB,QAAS,MAAO,CAAC,EAChC,MAAMC,GAVwBC,EAUYH,IATxBX,OAAOc,GAAUC,cAAcC,WAAW,SACrDhB,OAAOc,GACXN,MAAM,GACNS,QAAQ,aAAa,CAACC,EAAGC,IAAMA,EAAEC,gBAHyC,KAD/E,IAAgCN,EAW9B,MAAMlB,EAAM,CAAC,EACb,IAAK,MAAMyB,KAAOlC,EAAGyB,QACfS,IAAQR,IACZjB,EAAIyB,GAAOlC,EAAGyB,QAAQS,IAExB,OAAOzB,CACT,CAKA,MAAM0B,EACJ,WAAAxC,GACEyC,KAAKC,KAAO,IAAIC,GAClB,CACA,EAAAC,CAAGC,EAAOC,EAAIC,GACZ,GAAkB,mBAAPD,EAAmB,OAC9B,MAAME,EAAMP,KAAKC,KAAKO,IAAIJ,IAAU,GACpCG,EAAIE,KAAK,CAAEJ,KAAIC,IAAKA,GAAO,OAC3BN,KAAKC,KAAKS,IAAIN,EAAOG,EACvB,CACA,GAAAI,CAAIP,EAAOC,EAAIC,GACb,MAAMC,EAAMP,KAAKC,KAAKO,IAAIJ,GACrBG,GACLP,KAAKC,KAAKS,IACRN,EACAG,EAAIK,QAAQC,KAAQA,EAAER,KAAOA,IAAc,MAAPC,GAAeO,EAAEP,MAAQA,MAEjE,CACA,IAAAQ,CAAKV,EAAOW,EAASC,GACnB,MAAMT,EAAMP,KAAKC,KAAKO,IAAIJ,GAC1B,GAAKG,GAAQA,EAAIU,OACjB,IAAK,MAAMJ,KAAKN,EAAItB,QAClB,IACE4B,EAAER,GAAGa,KAAKL,EAAEP,KAAOU,GAAW,KAAMD,EACtC,CAAE,MAAOI,GAGT,CAEJ,CACA,KAAAC,GACEpB,KAAKC,KAAKmB,OACZ,EAMF,MAAMC,EACJ,WAAA9D,CAAY+D,EAAOC,GACjBvB,KAAKwB,GA7HT,SAAaC,EAAS,IACpB,OACEA,EACAC,KAAKC,SAASC,SAAS,IAAI3C,MAAM,EAAG,GACpC,IACAyC,KAAKC,SAASC,SAAS,IAAI3C,MAAM,EAAG,EAExC,CAsHc4C,CAAI,MACd7B,KAAKsB,MAAQA,EACbtB,KAAKuB,QAAUA,EACfvB,KAAK8B,OAAS,KACd9B,KAAK+B,SAAW,GAChB/B,KAAKgC,OAAQ,EACbhC,KAAKiC,YAAa,EAElBjC,KAAKkC,OAAS,UACdlC,KAAKmC,KAAO,IAAIpC,EAChBC,KAAKoC,YAAc,GAGnBpC,KAAKqC,KAAO,CAAEC,MAAO,EAAGC,KAAM,KAChC,CAEA,SAAIC,GACF,OAAOxC,KAAKkC,MACd,CACA,SAAIM,CAAMtD,GACRc,KAAKkC,OAAShD,EACdc,KAAKyC,QAAQ,eAAgB,CAAED,MAAOtD,EAAGoB,IAAKN,OAC9CA,KAAKyC,QAAQ,SAASvD,IAAKc,KAC7B,CAEA,EAAAG,CAAGC,EAAOC,EAAIC,GAEZ,OADAN,KAAKmC,KAAKhC,GAAGC,EAAOC,EAAIC,GAAON,MACxBA,IACT,CACA,GAAAW,CAAIP,EAAOC,EAAIC,GAEb,OADAN,KAAKmC,KAAKxB,IAAIP,EAAOC,EAAIC,GAAON,MACzBA,IACT,CACA,OAAAyC,CAAQrC,EAAOW,GAEb,OADAf,KAAKmC,KAAKrB,KAAKV,EAAOW,EAASf,MACxBA,IACT,CAGA,MAAA0C,CAAOtC,EAAOW,GACZ,IAAIlC,EAAImB,KAAK8B,OACb,KAAOjD,GACLA,EAAE4D,QAAQrC,EAAOW,GACjBlC,EAAIA,EAAEiD,OAER,OAAO9B,IACT,CAGA,QAAA2C,CAASvC,EAAOW,GACd,MAAM6B,EAAO5C,KAAKuB,SAAWvB,KAAKuB,QAAQsB,SAAW7C,KAAKuB,QAAQsB,SAAW,KAE7E,OADID,GAAMA,EAAKH,QAAQrC,EAAOW,GACvBf,IACT,CAEA,SAAA8C,CAAUzC,GAER,MADkB,mBAAPA,GAAmBL,KAAKoC,YAAY3B,KAAKJ,GAC7CL,IACT,CAEA,YAAA+C,GACE,IACM/C,KAAKqC,KAAKE,MAAMvC,KAAKqC,KAAKE,KAAKS,OACrC,CAAE,MAAOrD,GAAI,CACbK,KAAKqC,KAAKE,KAAO,IACnB,CAGA,iBAAMU,CAAY3E,EAAK4E,EAAY,CAAC,GAClClD,KAAKqC,KAAKC,OAAS,EACnB,MAAMa,EAAInD,KAAKqC,KAAKC,MAEpBtC,KAAK+C,eACL,MAAMR,EAAO,IAAIa,gBACjBpD,KAAKqC,KAAKE,KAAOA,EAEjB,MAAMc,QAAYC,MAAMhF,EAAKd,OAAO+F,OAAO,CAAC,EAAGL,EAAW,CAAEM,OAAQjB,EAAKiB,UACzE,GAAIxD,KAAKiC,WAAY,OAAO,KAC5B,GAAIkB,IAAMnD,KAAKqC,KAAKC,MAAO,OAAO,KAClC,IAAKe,EAAII,GAAI,MAAM,IAAI9F,MAAM,QAAQ0F,EAAIK,UAAUL,EAAIM,cACvD,MAAMC,QAAaP,EAAIO,OACvB,OAAI5D,KAAKiC,YACLkB,IAAMnD,KAAKqC,KAAKC,MADQ,KAErBsB,CACT,CAEA,OAAAC,GACE,GAAI7D,KAAKiC,WAAY,OACrBjC,KAAKiC,YAAa,EAElBjC,KAAKwC,MAAQ,aACbxC,KAAKyC,QAAQ,kBAAmBzC,MAEhCA,KAAK+C,eAGL,MAAMe,EAAO9D,KAAK+B,SAAS9C,QAC3Be,KAAK+B,SAAW,GAChB,IAAK,MAAMgC,KAAMD,EACf,IACMC,GAA4B,mBAAfA,EAAGF,SAAwBE,EAAGF,SACjD,CAAE,MAAOlE,GAAI,CAIf,MAAMqE,EAAKhE,KAAKoC,YAAYnD,QAAQgF,UACpCjE,KAAKoC,YAAc,GACnB,IAAK,MAAM/B,KAAM2D,EACf,IACE3D,EAAGL,KACL,CAAE,MAAOL,GAAI,CAGfK,KAAKmC,KAAKf,QACVpB,KAAKgC,OAAQ,EACbhC,KAAKwC,MAAQ,WACf,EAMF,MAAM0B,EACJ,WAAA3G,CAAYgE,EAAS7D,EAAMyG,GAgBzB,GAfAnE,KAAKuB,QAAUA,EAEfvB,KAAKoE,OAAS3G,EAAcC,GAC5BsC,KAAKqE,MAAQpH,EAAIA,EAAE+C,KAAKoE,QAAU,KAElCpE,KAAKmE,KAAO5C,EAAQ+C,eAAeH,GACnCnE,KAAK1B,IAAM0B,KAAKmE,KAAK7F,KAAO,GAC5B0B,KAAKzB,KAAOyB,KAAKmE,KAAK5F,MAAQ,CAAC,EAE/ByB,KAAK8B,OAAS9B,KAAKmE,KAAKrC,QAAU,KAClC9B,KAAK+B,SAAW,GAChB/B,KAAKuE,UAAW,EAChBvE,KAAKiC,YAAa,EAtOJrE,EAyOAoC,KAAKoE,OAzODlG,EAyOS8B,KAvOzBpC,EAAGR,KACPQ,EAAGR,GAAYc,IAAQ,EAChB,GAqO6B,CAEhC,MAAMsG,EAAWxG,EAAQgC,KAAKoE,QAC9B,GAAII,EAAU,OAAOA,EAErB,GAAIjD,EAAQkD,OAAOC,MACjB,MAAM,IAAI/G,MAAM,wDAEpB,CAjPJ,IAAkBC,EAAIM,GAPtB,SAAiBN,EAAIM,GACnBN,EAAGT,GAAYe,CACjB,CAyPIyG,CAAQ3E,KAAKoE,OAAQpE,MAGrBA,KAAKM,IAAM,IAAIe,EAAQrB,KAAMuB,GAGzBvB,KAAK8B,SAAW9B,KAAK8B,kBAAkBoC,GAAalE,KAAK8B,kBAAkB8C,KAC7E5E,KAAK8B,OAAOC,SAAStB,KAAKT,MAC1BA,KAAKM,IAAIwB,OAAS9B,KAAK8B,OAAOxB,IAC9BN,KAAK8B,OAAOxB,IAAIyB,SAAStB,KAAKT,KAAKM,MAIrCN,KAAKM,IAAIwC,WAAU,KACjB7E,EAAW+B,KAAKoE,OAAQpE,MAtQ9B,SAAmBpC,EAAIM,GACjBN,GAAMA,EAAGT,KAAce,IAAMN,EAAGT,GAAY,KAClD,CAqQM0H,CAAU7E,KAAKoE,OAAQpE,KAAK,GAEhC,CAGA,IAAA8E,CAAKC,GACH,OAAO/E,KAAKoE,OAAOtG,cAAciH,EACnC,CAEA,OAAAC,CAAQD,GACN,OAAOE,MAAMC,KAAKlF,KAAKoE,OAAOe,iBAAiBJ,GACjD,CAGA,WAAMK,GACJ,GAAIpF,KAAKiC,WAAY,OAAOjC,KAI5BA,KAAKM,IAAIkC,MAAQ,UAEjB,KAE4B,IAAtBxC,KAAKmE,KAAKkB,SAAmBrF,KAAKuB,QAAQ8D,QAAQC,KAAKtF,MAG3D,MAAM1B,EAAM0B,KAAKuB,QAAQgE,YAAYvF,KAAK1B,KACpCkH,QAAiBxF,KAAKM,IAAI2C,YAAY3E,EAAK0B,KAAKuB,QAAQkD,OAAOgB,cAAgB,CAAC,GACtF,GAAgB,MAAZD,EAAkB,OAAOxF,KAG7B,MAAM0F,SAACA,EAAQC,KAAEA,GAAQ3F,KAAKuB,QAAQqE,WAAWJ,EAAUxF,MAC3DA,KAAKM,IAAIkC,MAAQ,YAGjBxC,KAAKuB,QAAQsE,gBAAgB7F,KAAM0F,GAEnC1F,KAAKM,IAAIkC,MAAQ,OAEG,mBAATmD,SACHA,EAAK3F,KAAMA,KAAKzB,MAGxByB,KAAKM,IAAI0B,OAAQ,EACjBhC,KAAKM,IAAIkC,MAAQ,SAGU,IAAvBxC,KAAKmE,KAAK2B,UACZ9F,KAAK+F,KAAK,CAAEC,iBAAuD,IAAtChG,KAAKmE,KAAK8B,yBAG3C,CAAE,MAAO9E,GACPnB,KAAKM,IAAIkC,MAAQ,QACjBxC,KAAKuB,QAAQ2E,aAAalG,KAAMmB,GAC5BnB,KAAKuB,QAAQkD,OAAOC,OAAO1E,KAAKuB,QAAQ4E,IAAI,cAAehF,EACjE,CAAE,QACAnB,KAAKuB,QAAQ8D,QAAQe,KAAKpG,MAC1B/B,EAAW+B,KAAKoE,OAAQpE,KAC1B,CAEA,OAAOA,IACT,CAGA,IAAA+F,EAAKC,gBAAEA,GAAkB,GAAU,CAAC,GAClC,OAAIhG,KAAKiC,YAILjC,KAAKuE,WAAgC,IAApByB,IACrBhG,KAAKuE,UAAW,EAEhBvE,KAAKuB,QAAQwE,KAAK/F,KAAKoE,OAAQ,CAC7BtC,OAAQ9B,KACRgG,qBAT0BhG,IAa9B,CAGA,aAAMqG,GACJ,OAAIrG,KAAKiC,WAAmBjC,MAC5BA,KAAK6D,UAEE7D,KAAKuB,QAAQ6D,MAAMpF,KAAKoE,OAAQ5G,OAAO+F,OAAO,CAAC,EAAGvD,KAAKmE,KAAM,CAAEzE,SAAS,KACjF,CAEA,OAAAmE,GACE,GAAI7D,KAAKiC,WAAY,OACrBjC,KAAKiC,YAAa,EAGlB,MAAM6B,EAAO9D,KAAK+B,SAAS9C,QAC3Be,KAAK+B,SAAW,GAChB,IAAK,MAAMgC,KAAMD,EACf,IACEC,EAAGF,SACL,CAAE,MAAOlE,GAAI,CAIf,IACEK,KAAKM,IAAIuD,SACX,CAAE,MAAOlE,GAAI,CAIb,IACEK,KAAKoE,OAAOkC,UAAY,EAC1B,CAAE,MAAO3G,GAAI,CAGb,GAAIK,KAAK8B,QAAU9B,KAAK8B,OAAOC,SAAU,CACvC,MAAMjD,EAAIkB,KAAK8B,OAAOC,SAAShD,QAAQiB,OAC5B,IAAPlB,GAAUkB,KAAK8B,OAAOC,SAASwE,OAAOzH,EAAG,EAC/C,CACF,EAMF,MAAM8F,EACJ,WAAArH,CAAYgE,EAAS4C,GACnBnE,KAAKuB,QAAUA,EACf4C,EAAO5C,EAAQiF,qBAAqBrC,GACpCnE,KAAK1B,IAAM6F,EAAK7F,KAAO,GACvB0B,KAAKzB,KAAO4F,EAAK5F,MAAQ,CAAC,EAC1ByB,KAAK8B,OAASqC,EAAKrC,QAAU,KAC7B9B,KAAK+B,SAAW,GAChB/B,KAAKoE,OAAS,KAEdpE,KAAKM,IAAM,IAAIe,EAAQrB,KAAMuB,GAEzBvB,KAAK8B,SAAW9B,KAAK8B,kBAAkBoC,GAAalE,KAAK8B,kBAAkB8C,KAC7E5E,KAAK8B,OAAOC,SAAStB,KAAKT,MAC1BA,KAAKM,IAAIwB,OAAS9B,KAAK8B,OAAOxB,IAC9BN,KAAK8B,OAAOxB,IAAIyB,SAAStB,KAAKT,KAAKM,KAEvC,CAEA,SAAMmG,GACJ,GAAIzG,KAAKM,IAAI2B,WAAY,OAAOjC,KAChC,IAAKA,KAAK1B,IAGR,OAFA0B,KAAKM,IAAIkC,MAAQ,QACbxC,KAAKuB,QAAQkD,OAAOC,OAAO1E,KAAKuB,QAAQ4E,IAAI,sBACzCnG,KAETA,KAAKM,IAAIkC,MAAQ,UACbxC,KAAKuB,QAAQkD,OAAOC,OAAO1E,KAAKuB,QAAQ4E,IAAI,aAAcnG,KAAK1B,KAEnE,IACE,MAAMA,EAAM0B,KAAKuB,QAAQgE,YAAYvF,KAAK1B,KACpCkH,QAAiBxF,KAAKM,IAAI2C,YAAY3E,EAAK0B,KAAKuB,QAAQkD,OAAOgB,cAAgB,CAAC,GACtF,GAAgB,MAAZD,EAAkB,OAAOxF,KAC7B,MAAM0F,SAAEA,EAAQC,KAAEA,GAAS3F,KAAKuB,QAAQqE,WAAWJ,EAAUxF,MAC7DA,KAAKoE,OAASsB,EAASgB,WAAU,GACjCC,QAAQR,IAAI,SAASnG,KAAKoE,QAE1BpE,KAAKM,IAAIkC,MAAQ,OACG,mBAATmD,SACHA,EAAK3F,KAAMA,KAAKzB,MAExByB,KAAKM,IAAI0B,OAAQ,EACjBhC,KAAKM,IAAIkC,MAAQ,OACnB,CAAE,MAAOrB,GACPnB,KAAKM,IAAIkC,MAAQ,QACbxC,KAAKuB,QAAQkD,OAAOC,OAAO1E,KAAKuB,QAAQ4E,IAAI,mBAAoBnG,KAAK1B,IAAK6C,EAChF,CACA,OAAOnB,IACT,CAEA,OAAA6D,GACE,MAAMC,EAAO9D,KAAK+B,SAAS9C,QAC3Be,KAAK+B,SAAW,GAChB,IAAK,MAAMgC,KAAMD,EACf,IACMC,GAA4B,mBAAfA,EAAGF,SAAwBE,EAAGF,SACjD,CAAE,MAAOlE,GAAI,CAEf,IACEK,KAAKM,IAAIuD,SACX,CAAE,MAAOlE,GAAI,CACb,GAAIK,KAAK8B,QAAU9B,KAAK8B,OAAOC,SAAU,CACvC,MAAMjD,EAAIkB,KAAK8B,OAAOC,SAAShD,QAAQiB,OAC5B,IAAPlB,GAAUkB,KAAK8B,OAAOC,SAASwE,OAAOzH,EAAG,EAC/C,CACF,EAMF,MAAM8H,EACJ,WAAArJ,CAAYgE,GACVvB,KAAKuB,QAAUA,EACfvB,KAAK6G,UAAW,EAChB7G,KAAK8G,SAAW,KAChB9G,KAAK+G,OAAS,GACd/G,KAAKgH,OAAS,KACdhH,KAAKiH,SAAW,IAClB,CAGA,QAAAC,CAASC,GACP,MAAMC,EAAO,GACb,IAAIC,EAAK,IAAMF,EAAQzH,QAAQ,sBAAuB,QAMtD,OALA2H,EAAKA,EAAG3H,QAAQ,uBAAuB,CAACC,EAAGX,KACzCoI,EAAK3G,KAAKzB,GACH,aAETqI,GAAM,IACC,CAAEC,MAAO,IAAIC,OAAOF,GAAKD,OAClC,CAEA,SAAAI,EAAUR,OAAEA,EAAS,OAAMD,OAAEA,EAAS,CAAC,EAACE,SAAEA,EAAW,MAAS,CAAC,GAW7D,OAVAjH,KAAKgH,OAASA,EACdhH,KAAKiH,SAAWA,EAChBjH,KAAK+G,OAAS,GAGV9B,MAAMwC,QAAQV,GAChBA,EAAOnI,SAAS8I,GAAM1H,KAAK2H,IAAID,EAAEE,KAAMF,EAAEpJ,OAEzCd,OAAOqK,QAAQd,GAAQnI,SAAQ,EAAEgJ,EAAMtJ,KAAS0B,KAAK2H,IAAIC,EAAMtJ,KAE1D0B,IACT,CAEA,GAAA2H,CAAIG,EAAaxJ,GACf,MAAMsB,EAAII,KAAKkH,SAASY,GAExB,OADA9H,KAAK+G,OAAOtG,KAAK,CAAE0G,QAASW,EAAaV,KAAMxH,EAAEwH,KAAME,MAAO1H,EAAE0H,MAAOhJ,QAChE0B,IACT,CAEA,KAAA+H,CAAMC,GACJ,IAAK,MAAMN,KAAK1H,KAAK+G,OAAQ,CAC3B,MAAMkB,EAAIP,EAAEJ,MAAMY,KAAKF,GACvB,IAAKC,EAAG,SACR,MAAME,EAAS,CAAC,EAEhB,OADAT,EAAEN,KAAKxI,SAAQ,CAACI,EAAGF,IAAOqJ,EAAOnJ,GAAKiJ,EAAEnJ,EAAI,KACrC,CAAER,IAAKoJ,EAAEpJ,IAAK8J,MAAO,CAAEJ,OAAMG,UACtC,CACA,OAAO,IACT,CAEA,KAAAE,GACMrI,KAAK6G,WACT7G,KAAK6G,UAAW,EAEhB7G,KAAK8G,SAAW,KACd,MAAMkB,EAAOhL,EAAOsL,SAASN,MAAQ,KAC/BD,EAAQ/H,KAAK+H,MAAMC,GAEnBO,EAAW9K,EAAcuC,KAAKgH,QAE/Be,EAYL/H,KAAKuB,QAAQ6D,MAAMmD,EAAU,CAC3BjK,IAAKyJ,EAAMzJ,IACXC,KAAM,CAAE6J,MAAOL,EAAMK,OACrB1I,SAAS,EACToC,OAAQ,OAfJ9B,KAAKiH,UACPjH,KAAKuB,QAAQ6D,MAAMmD,EAAU,CAC3BjK,IAAK0B,KAAKiH,SACV1I,KAAM,CAAE6J,MAAO,CAAEJ,OAAMG,OAAQ,CAAC,IAChCzI,SAAS,EACToC,OAAQ,MAWZ,EAGJ9E,EAAOwL,iBAAiB,aAAcxI,KAAK8G,UAC3C9J,EAAOwL,iBAAiB,OAAQxI,KAAK8G,UACrC9G,KAAK8G,WACP,CAEA,IAAA2B,GACOzI,KAAK6G,WACV7G,KAAK6G,UAAW,EACZ7G,KAAK8G,WACP9J,EAAO0L,oBAAoB,aAAc1I,KAAK8G,UAC9C9J,EAAO0L,oBAAoB,OAAQ1I,KAAK8G,WAE1C9G,KAAK8G,SAAW,KAClB,CAEA,QAAA6B,CAASX,GACPhL,EAAOsL,SAASN,KAAOA,CACzB,EAMF,MAAMY,EACJ,WAAArL,CAAYkH,EAAS,CAAC,GACpBzE,KAAKyE,OAASjH,OAAO+F,OACnB,CACEmB,OAAO,EACPmE,QAAS,KAETC,aAAc,oBACdC,YACE,+FAEF3J,WAAY,iBAEZ4J,UAAW,CAAC1K,EAAK2K,IACf,oFAAoF3K,eAExFmG,GAGFzE,KAAKkJ,MAAQ,KACblJ,KAAK6C,SAAW,KAEhB7C,KAAKmJ,OAAS,IAAIvC,EAAW5G,MAG7BA,KAAKqF,QAAU,CACbC,KAAOtG,GAAMgB,KAAKoJ,aAAapK,GAC/BoH,KAAOpH,GAAMgB,KAAKqJ,aAAarK,GAEnC,CAEA,GAAAmH,IAAOmD,GACDtJ,KAAKyE,OAAOC,OAAOiC,QAAQR,IAAI,mBAAoBmD,EACzD,CAEA,cAAAhF,CAAeH,GACb,GAAoB,iBAATA,EACT,MAAO,CAAE7F,IAAK6F,EAAM5F,KAAM,CAAC,EAAGmB,SAAS,EAAOoG,UAAU,EAAMT,SAAS,GAEzE,IAAKhI,EAAc8G,GACjB,MAAO,CAAE7F,IAAK,GAAIC,KAAM,CAAC,EAAGmB,SAAS,EAAOoG,UAAU,EAAMT,SAAS,GAEvE,MAAMkE,EAAI/L,OAAO+F,OACf,CACEjF,IAAK,GACLC,KAAM,CAAC,EACPmB,SAAS,EACToG,UAAU,EACVT,SAAS,EACTvD,OAAQ,MAEVqC,GAGF,GAAqB,iBAAVoF,EAAEjL,KAAoBiL,EAAEjL,IAAIkL,SAAS,KAAM,CACpD,MAAMC,EAAStL,EAAUoL,EAAEjL,KAC3BiL,EAAEjL,IAAMmL,EAAOnL,IACfiL,EAAEhL,KAAOf,OAAO+F,OAAO,CAAC,EAAGkG,EAAOlL,KAAMgL,EAAEhL,MAAQ,CAAC,EACrD,CACA,OAAOgL,CACT,CAGA,oBAAA/C,CAAqBkD,GACnB,IAAIpL,EAAM,GACNC,EAAO,CAAC,EACRuD,EAAS,KACb,GAAyB,iBAAd4H,EAAwB,CACjC,MAAMD,EAAStL,EAAUuL,GACzBpL,EAAMmL,EAAOnL,IACbC,EAAOf,OAAO+F,OAAO,CAAC,EAAGkG,EAAOlL,KAClC,MAAO,GAAIlB,EAAcqM,GAAY,CACnC,MAAMH,EAAIG,EACVpL,EAAMiL,EAAEjL,KAAO,GACf,MAAMqL,EAAUrL,GAAOA,EAAIkL,SAAS,KAAOrL,EAAUG,GAAKC,KAAO,CAAC,EAClEA,EAAOf,OAAO+F,OAAO,CAAC,EAAGoG,EAASJ,EAAEhL,MAAQ,CAAC,GAC7CuD,EAAqB,MAAZyH,EAAEzH,OAAiByH,EAAEzH,OAAS,IACzC,CACA,MAAO,CAAExD,MAAKC,OAAMuD,SACtB,CAEA,WAAAyD,CAAYjH,GACV,OAAKA,GACD0B,KAAKyE,OAAOoE,SAAsB,MAAXvK,EAAI,GAAmB0B,KAAKyE,OAAOoE,QAAUvK,EADvDA,CAGnB,CAGA,UAAAsH,CAAWJ,EAAUoE,GAEnB,MAAMzG,EAAItF,SAASgM,cAAc,YACjC1G,EAAEmD,UAAY7H,OAAO+G,GAErB,MAAMsE,EAAU7E,MAAMC,KAAK/B,EAAE4G,QAAQ5E,iBAAiB,WAChD6E,EAAOF,EAAQG,KAAKC,GAAMA,EAAEC,aAAe,KAAIC,KAAK,MAC1DN,EAAQlL,SAASsL,GAAMA,EAAEG,WAEzB,MAAM3E,EAAWvC,EAAE4G,QAKnB,IAAIpE,EAAO,KACX,GAAIqE,EAAKM,OACP,IAGE,MAaMC,EAbK,IAAIC,SACb,YACA,OACA,cACA,gDAEER,oWAOU3J,CAAGuJ,EAAWA,EAAUrL,KAAMyB,MACvB,mBAAVuK,IAAsB5E,EAAO4E,EAC1C,CAAE,MAAOpJ,GACHnB,KAAKyE,OAAOC,OAAO1E,KAAKmG,IAAI,mBAAoBhF,EACtD,CAEF,MAAO,CAAEuE,WAAUC,OACrB,CAEA,eAAAE,CAAgB+D,EAAWlE,GACzB,MAAMhI,EAAOkM,EAAUxF,OAEvB1G,EAAK4I,UAAY,GAEjB5I,EAAK+M,YAAY/E,EAASgB,WAAU,GACtC,CAEA,YAAAR,CAAa0D,EAAWX,GACtB,IACEW,EAAUxF,OAAOkC,UAAYtG,KAAKyE,OAAOuE,UAAUY,EAAUtL,IAAK2K,EACpE,CAAE,MAAOtJ,GAAI,CACf,CAEA,YAAAyJ,CAAapK,GACX,MAAMtB,EAAOsB,EAAEoF,OACf,IAAK1G,EAAM,OAQX,GAAIsB,EAAE0L,YAAc1L,EAAE0L,WAAWC,WAAY,OAE7C,MAAMC,EAAK/M,SAASgM,cAAc,OAClCe,EAAGC,UAAY7K,KAAKyE,OAAOqE,aAC3B8B,EAAGtE,UAAYtG,KAAKyE,OAAOsE,YAE3B6B,EAAGE,MAAMC,SAAW,WACpBH,EAAGE,MAAME,UAAY,OACrBJ,EAAGE,MAAMG,OAAS,oBAClBL,EAAGE,MAAMI,WAAa,OACtBN,EAAGE,MAAMK,OAAS,SAElBnM,EAAE0L,WAAaE,EACflN,EAAK0N,aAAaR,EAAIlN,EAAK2N,WAC7B,CAEA,YAAAhC,CAAarK,GACX,MAAM4L,EAAK5L,EAAE0L,WACTE,GAAMA,EAAGD,YAAYC,EAAGD,WAAWW,YAAYV,GACnD5L,EAAE0L,WAAa,IACjB,CAGA,IAAA9H,CAAKlF,EAAMgM,GACT,MAAM9L,EAAKH,EAAcC,GAEzB,GAAIsC,KAAKkJ,MAAO,CACd,IACElJ,KAAKkJ,MAAMrF,SACb,CAAE,MAAOlE,GAAI,CACbK,KAAKkJ,MAAQ,KACblJ,KAAK6C,SAAW,IAClB,CACA,MAAM7D,EAAIgB,KAAKoF,MAAMxH,EAAIJ,OAAO+F,OAAO,CAAC,EAAGvD,KAAKsE,eAAeoF,GAAY,CAAEhK,SAAS,EAAMoC,OAAQ,QAGpG,OAFA9B,KAAKkJ,MAAQlK,EACbgB,KAAK6C,SAAW7D,GAAKA,EAAEsB,IAAMtB,EAAEsB,IAAM,KAC9BtB,CACT,CAEA,KAAAoG,CAAM1H,EAAMgM,GACV,MAAM9L,EAAKH,EAAcC,GACnByG,EAAOnE,KAAKsE,eAAeoF,GAI3BlF,EAAWxG,EAAQJ,GAGzB,GADI4G,GAAYA,aAAoBN,GAAaC,EAAKzE,SAAS8E,EAASX,UACpEW,IAAaL,EAAKzE,QAAS,OAAO8E,EAGtC,MAAMxF,EAAI,IAAIkF,EAAUlE,KAAMpC,EAAIuG,GAMlC,OAFAnF,EAAEoG,QAEKpG,CACT,CAEA,IAAA+G,CAAKwF,EAAY1N,SAAS2N,MAAM1J,OAAEA,EAAS,KAAIkE,gBAAEA,GAAkB,GAAU,CAAC,GAC5E,MAAMpD,EAAOnF,EAAc8N,GACrBE,EAAOzL,KAAKyE,OAAOrF,WAEnBsM,EAAQzG,MAAMC,KAAKtC,EAAKuC,iBAAiB,IAAIsG,OACnD,IAAK,MAAME,KAAQD,EAAO,CACxB,MACMjC,EAAStL,EADFwN,EAAKC,aAAaH,IAAS,IAElCI,EAAgB1M,EAA6BwM,EAAMF,GACnDlN,EAAOf,OAAO+F,OAAO,CAAC,EAAGkG,EAAOlL,KAAMsN,GAEtCrH,EAAWxG,EAAQ2N,GACzB,IAAInH,GAAawB,EAAjB,CAEA,GAAIxB,GAAYwB,EACd,IACExB,EAASX,SACX,CAAE,MAAOlE,GAAI,CAGfK,KAAKoF,MAAMuG,EAAM,CACfrN,IAAKmL,EAAOnL,IACZC,OACAuD,OAAQA,EACRpC,SAAS,GAZ+B,CAc5C,CACF,CAEA,KAAA0I,EAAMpB,OAAEA,EAAS,OAAMD,OAAEA,EAAS,CAAC,EAACE,SAAEA,EAAW,MAAS,CAAC,GACzDjH,KAAKmJ,OAAO3B,UAAU,CAAER,SAAQD,SAAQE,aAAYoB,OACtD,CAEA,QAAAM,CAASX,GACPhI,KAAKmJ,OAAOR,SAASX,EACvB,CAGA,MAAA8D,CAAOpC,GACL,MAAMnI,EAAUvB,KACVmE,EAAO5C,EAAQiF,qBAAqBkD,GAC1C,IAAIqC,EAAO5H,EAAK7F,IACZ0N,EAAQxO,OAAO+F,OAAO,CAAC,EAAGY,EAAK5F,MACnC,MAAO,CACL,IAAAA,CAAK0N,EAAUC,GAQb,OAPAvF,QAAQR,IAAI,OAAO8F,EAAUC,GACb,MAAZD,GAAwC,iBAAbA,GAC7BtF,QAAQR,IAAI,WAAW8F,GACvBzO,OAAO+F,OAAOyI,EAAOC,IACA,MAAZA,IACTD,EAAMC,GAAYC,GAEblM,IACT,EACA,UAAMmM,EAAKrK,OAAEA,GAAW,CAAC,GACvB,MAAMgK,EAAS,IAAIlH,EAAOrD,EAAS,CAAEjD,IAAKyN,EAAMxN,KAAMyN,EAAOlK,WAE7D,aADMgK,EAAOrF,MACNqF,CACT,EAEJ,CAGA,eAAMM,CAAU9N,EAAKC,GAAMuD,OAAEA,GAAW,CAAC,GACvC,MAAMqC,EAAOnE,KAAKwG,qBAAqB,CAAElI,MAAKC,SACxCuN,EAAS,IAAIlH,EAAO5E,KAAM,CAAE1B,IAAK6F,EAAK7F,IAAKC,KAAM4F,EAAK5F,KAAMuD,WAElE,aADMgK,EAAOrF,MACNqF,CACT,EAMF,MAAMO,EAAIrP,EAAOsP,YAActP,EAAOsP,aAAe,CAAC,EAEtD,KAAMD,aAAazD,GAAc,CAC/B,MAAM1K,EAAO,IAAI0K,EAAYyD,GAAKhP,EAAcgP,GAAKA,EAAI,CAAC,GAE1DrP,EAAOsP,YAAcpO,CACvB,CAGAlB,EAAOsP,YAAY1D,YAAcA,EACjC5L,EAAOsP,YAAYpI,UAAYA,EAC/BlH,EAAOsP,YAAYjL,QAAUA,EAC7BrE,EAAOsP,YAAY1F,WAAaA,EAChC5J,EAAOsP,YAAY1H,OAASA,CAE7B,CA34BH,CA24BK2H","file":"komponentor.min.js","sourcesContent":["/*!\n * Komponentor (single-file)\n * - Tree of components (parent/children), local scan\n * - Destroy cascades\n * - Optional hash router\n * - jQuery optional (used only as helper if present)\n *\n * Public API (minimal):\n *   komponentor.root(host, urlOrOpts)\n *   komponentor.mount(host, urlOrOpts)\n *   komponentor.scan(container?, { parent?, replaceExisting? })\n *   komponentor.route({ outlet, routes, notFound })\n *   komponentor.navigate(hash)\n *   komponentor.intent(urlOrOpts)  -> fluent .data(...).send({ parent })\n *   komponentor.runIntent(url, data, { parent })\n *\n * Component marker:\n *   <div data-komponent=\"/path/to/component.html|id=5|foo=bar\"></div>\n *\n * Intent usage examples:\n *   // From a component (intent becomes part of the branch; destroyed when parent is destroyed)\n *   async function init_komponent(k, data) {\n *     const i = await komponentor.intent(\"modal.html|id=1\").data({ source: k }).send({ parent: k });\n *     // i.ctx.ready, i.data; i may mount DOM via komponentor.mount(...) inside modal's init\n *   }\n *\n *   // Global intent (no parent; not attached to any component tree)\n *   const i = await komponentor.runIntent(\"service/worker.html\", { task: \"sync\" });\n */\n\n(function (global) {\n    \"use strict\";\n  \n    const $ = global.jQuery || null;\n  \n    // ----------------------------\n    // utils\n    // ----------------------------\n    const KEY_INST = \"__kp_instance__\";\n    const KEY_LOCK = \"__kp_mounting__\";\n  \n    function isPlainObject(x) {\n      return x && typeof x === \"object\" && x.constructor === Object;\n    }\n  \n    function uid(prefix = \"\") {\n      return (\n        prefix +\n        Math.random().toString(36).slice(2, 9) +\n        \"_\" +\n        Math.random().toString(36).slice(2, 7)\n      );\n    }\n  \n    function normalizeHost(host) {\n      if (!host) throw new Error(\"Invalid host\");\n      if (typeof host === \"string\") {\n        const el = document.querySelector(host);\n        if (!el) throw new Error(`Host not found: ${host}`);\n        return el;\n      }\n      if ($ && host instanceof $) return host[0];\n      if (host instanceof Element) return host;\n      throw new Error(\"Invalid host type\");\n    }\n  \n    function getInst(el) {\n      return el ? el[KEY_INST] || null : null;\n    }\n    function setInst(el, inst) {\n      el[KEY_INST] = inst;\n    }\n    function clearInst(el, inst) {\n      if (el && el[KEY_INST] === inst) el[KEY_INST] = null;\n    }\n  \n    function lockHost(el, inst) {\n      // lock to prevent concurrent double-mount\n      if (el[KEY_LOCK]) return false;\n      el[KEY_LOCK] = inst || true;\n      return true;\n    }\n    function unlockHost(el, inst) {\n      if (!el) return;\n      if (el[KEY_LOCK] === inst || inst == null) el[KEY_LOCK] = null;\n    }\n  \n    function parseSpec(specText) {\n      // \"/a/b.html|x=1|y=2\" -> { url, data }\n      const out = { url: \"\", data: {} };\n      if (!specText) return out;\n      const parts = String(specText).split(\"|\");\n      out.url = parts.shift() || \"\";\n      parts.forEach((p) => {\n        if (!p) return;\n        const i = p.indexOf(\"=\");\n        if (i === -1) {\n          out.data[p] = null;\n        } else {\n          const k = p.slice(0, i);\n          const v = p.slice(i + 1);\n          out.data[k] = v === \"\" ? \"\" : v;\n        }\n      });\n      return out;\n    }\n\n    // data-komponent -> \"komponent\" (dataset key for exclusion)\n    function markerAttrToDatasetKey(attrName) {\n      if (!attrName || !String(attrName).toLowerCase().startsWith(\"data-\")) return null;\n      return String(attrName)\n        .slice(5)\n        .replace(/-([a-z])/g, (_, c) => c.toUpperCase());\n    }\n\n    // All data-* attributes from element as object (camelCase keys), excluding markerAttr\n    function getDataAttributesFromElement(el, markerAttr) {\n      if (!el || !el.dataset) return {};\n      const excludeKey = markerAttrToDatasetKey(markerAttr);\n      const out = {};\n      for (const key in el.dataset) {\n        if (key === excludeKey) continue;\n        out[key] = el.dataset[key];\n      }\n      return out;\n    }\n  \n    // ----------------------------\n    // EventBus (scoped)\n    // ----------------------------\n    class EventBus {\n      constructor() {\n        this._map = new Map(); // event -> [{fn,ctx}]\n      }\n      on(event, fn, ctx) {\n        if (typeof fn !== \"function\") return;\n        const arr = this._map.get(event) || [];\n        arr.push({ fn, ctx: ctx || null });\n        this._map.set(event, arr);\n      }\n      off(event, fn, ctx) {\n        const arr = this._map.get(event);\n        if (!arr) return;\n        this._map.set(\n          event,\n          arr.filter((l) => !(l.fn === fn && (ctx == null || l.ctx === ctx)))\n        );\n      }\n      emit(event, payload, thisArg) {\n        const arr = this._map.get(event);\n        if (!arr || !arr.length) return;\n        for (const l of arr.slice()) {\n          try {\n            l.fn.call(l.ctx || thisArg || null, payload);\n          } catch (e) {\n            // swallow: event handlers must not crash framework\n            // (caller can enable debug logs in config)\n          }\n        }\n      }\n      clear() {\n        this._map.clear();\n      }\n    }\n  \n    // ----------------------------\n    // Context (kernel)\n    // ----------------------------\n    class Context {\n      constructor(owner, manager) {\n        this.id = uid(\"k_\");\n        this.owner = owner; // Komponent instance\n        this.manager = manager; // Komponentor\n        this.parent = null;\n        this.children = [];\n        this.ready = false;\n        this._destroyed = false;\n  \n        this._state = \"initial\";\n        this._bus = new EventBus();\n        this._destroyers = [];\n  \n        // request lifecycle (1 active per context, abort on new/destroy)\n        this._req = { token: 0, ctrl: null };\n      }\n  \n      get state() {\n        return this._state;\n      }\n      set state(v) {\n        this._state = v;\n        this.trigger(\"state:change\", { state: v, ctx: this });\n        this.trigger(`state:${v}`, this);\n      }\n  \n      on(event, fn, ctx) {\n        this._bus.on(event, fn, ctx || this);\n        return this;\n      }\n      off(event, fn, ctx) {\n        this._bus.off(event, fn, ctx || this);\n        return this;\n      }\n      trigger(event, payload) {\n        this._bus.emit(event, payload, this);\n        return this;\n      }\n  \n      // bubble-up event (cross-branch through common ancestor)\n      emitUp(event, payload) {\n        let p = this.parent;\n        while (p) {\n          p.trigger(event, payload);\n          p = p.parent;\n        }\n        return this;\n      }\n  \n      // root-level event (global within app root)\n      emitRoot(event, payload) {\n        const root = this.manager && this.manager._rootCtx ? this.manager._rootCtx : null;\n        if (root) root.trigger(event, payload);\n        return this;\n      }\n  \n      onDestroy(fn) {\n        if (typeof fn === \"function\") this._destroyers.push(fn);\n        return this;\n      }\n  \n      requestAbort() {\n        try {\n          if (this._req.ctrl) this._req.ctrl.abort();\n        } catch (_) {}\n        this._req.ctrl = null;\n      }\n  \n      // fetch wrapper with stale-guard\n      async requestText(url, fetchOpts = {}) {\n        this._req.token += 1;\n        const t = this._req.token;\n  \n        this.requestAbort();\n        const ctrl = new AbortController();\n        this._req.ctrl = ctrl;\n  \n        const res = await fetch(url, Object.assign({}, fetchOpts, { signal: ctrl.signal }));\n        if (this._destroyed) return null;\n        if (t !== this._req.token) return null; // stale\n        if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);\n        const text = await res.text();\n        if (this._destroyed) return null;\n        if (t !== this._req.token) return null;\n        return text;\n      }\n  \n      destroy() {\n        if (this._destroyed) return;\n        this._destroyed = true;\n  \n        this.state = \"destroying\";\n        this.trigger(\"context:destroy\", this);\n  \n        this.requestAbort();\n  \n        // destroy children contexts first (safety)\n        const kids = this.children.slice();\n        this.children = [];\n        for (const ch of kids) {\n          try {\n            if (ch && typeof ch.destroy === \"function\") ch.destroy();\n          } catch (_) {}\n        }\n  \n        // run destroyers in reverse\n        const ds = this._destroyers.slice().reverse();\n        this._destroyers = [];\n        for (const fn of ds) {\n          try {\n            fn(this);\n          } catch (_) {}\n        }\n  \n        this._bus.clear();\n        this.ready = false;\n        this.state = \"destroyed\";\n      }\n    }\n  \n    // ----------------------------\n    // Komponent (node in tree)\n    // ----------------------------\n    class Komponent {\n      constructor(manager, host, opts) {\n        this.manager = manager;\n  \n        this.hostEl = normalizeHost(host);\n        this.$host = $ ? $(this.hostEl) : null;\n  \n        this.opts = manager._normalizeOpts(opts);\n        this.url = this.opts.url || \"\";\n        this.data = this.opts.data || {};\n  \n        this.parent = this.opts.parent || null;\n        this.children = [];\n        this._scanned = false;\n        this._destroyed = false;\n  \n        // mount \"lock\" early (prevents concurrent double-mount)\n        if (!lockHost(this.hostEl, this)) {\n          // if another mount is in-flight, best effort: return existing instance if any\n          const existing = getInst(this.hostEl);\n          if (existing) return existing;\n          // else: allow but it's risky; throw in debug\n          if (manager.config.debug) {\n            throw new Error(\"Host is already mounting (concurrent mount detected).\");\n          }\n        }\n  \n        // attach instance to host early (ownership)\n        setInst(this.hostEl, this);\n  \n        // context\n        this.ctx = new Context(this, manager);\n  \n        // link parent/child (component tree); parent may be Komponent or Intent\n        if (this.parent && (this.parent instanceof Komponent || this.parent instanceof Intent)) {\n          this.parent.children.push(this);\n          this.ctx.parent = this.parent.ctx;\n          this.parent.ctx.children.push(this.ctx);\n        }\n  \n        // cleanup ownership on destroy\n        this.ctx.onDestroy(() => {\n          unlockHost(this.hostEl, this);\n          clearInst(this.hostEl, this);\n        });\n      }\n  \n      // helper: scoped query\n      find(selector) {\n        return this.hostEl.querySelector(selector);\n      }\n\n      findAll(selector) {\n        return Array.from(this.hostEl.querySelectorAll(selector));\n      }\n  \n      // public: mount once (if re-called, destroys first by policy)\n      async mount() {\n        if (this._destroyed) return this;\n  \n        // policy: if mount called again, destroy then remount (user requested)\n        // (manager.mount() also enforces replace if needed)\n        this.ctx.state = \"loading\";\n  \n        try {\n          // overlay\n          if (this.opts.overlay !== false) this.manager.overlay.show(this);\n  \n          // fetch html\n          const url = this.manager._resolveUrl(this.url);\n          const htmlText = await this.ctx.requestText(url, this.manager.config.fetchOptions || {});\n          if (htmlText == null) return this;\n  \n          // parse -> template + init\n          const {fragment, init} = this.manager._parseHtml(htmlText, this);\n          this.ctx.state = \"rendering\";\n  \n          // render into host (replace contents)\n          this.manager._renderIntoHost(this, fragment);\n  \n          this.ctx.state = \"init\";\n          // run init (if exists)\n          if (typeof init === \"function\") {\n            await init(this, this.data);\n          }\n  \n          this.ctx.ready = true;\n          this.ctx.state = \"ready\";\n  \n          // auto-scan children (once per component lifetime)\n          if (this.opts.autoload !== false) {\n            this.scan({ replaceExisting: this.opts.replaceExistingChildren === true });\n          }\n  \n        } catch (e) {\n          this.ctx.state = \"error\";\n          this.manager._renderError(this, e);\n          if (this.manager.config.debug) this.manager.log(\"mount error\", e);\n        } finally {\n          this.manager.overlay.hide(this);\n          unlockHost(this.hostEl, this);\n        }\n  \n        return this;\n      }\n  \n      // scan local branch only\n      scan({ replaceExisting = false } = {}) {\n        if (this._destroyed) return this;\n  \n        // If your model says \"scan can be re-run and must replace\", you can allow it;\n        // but default stays \"once\" to keep branch stable unless explicitly changed.\n        if (this._scanned && replaceExisting !== true) return this;\n        this._scanned = true;\n  \n        this.manager.scan(this.hostEl, {\n          parent: this,\n          replaceExisting,\n        });\n  \n        return this;\n      }\n  \n      // explicit remount policy: destroy then mount\n      async remount() {\n        if (this._destroyed) return this;\n        this.destroy();\n        // create a fresh instance on same host\n        return this.manager.mount(this.hostEl, Object.assign({}, this.opts, { replace: true }));\n      }\n  \n      destroy() {\n        if (this._destroyed) return;\n        this._destroyed = true;\n  \n        // destroy children first (component-level)\n        const kids = this.children.slice();\n        this.children = [];\n        for (const ch of kids) {\n          try {\n            ch.destroy();\n          } catch (_) {}\n        }\n  \n        // context destroy (also destroys ctx children via ctx.children)\n        try {\n          this.ctx.destroy();\n        } catch (_) {}\n  \n        // DOM ownership cleanup:\n        // you said host stays; component clears only its interior\n        try {\n          this.hostEl.innerHTML = \"\";\n        } catch (_) {}\n  \n        // unlink from parent component list (best effort)\n        if (this.parent && this.parent.children) {\n          const i = this.parent.children.indexOf(this);\n          if (i !== -1) this.parent.children.splice(i, 1);\n        }\n      }\n    }\n\n    // ----------------------------\n    // Intent (headless: no DOM, no render, no data-bind)\n    // ----------------------------\n    class Intent {\n      constructor(manager, opts) {\n        this.manager = manager;\n        opts = manager._normalizeIntentOpts(opts);\n        this.url = opts.url || \"\";\n        this.data = opts.data || {};\n        this.parent = opts.parent || null;\n        this.children = [];\n        this.hostEl = null;\n\n        this.ctx = new Context(this, manager);\n\n        if (this.parent && (this.parent instanceof Komponent || this.parent instanceof Intent)) {\n          this.parent.children.push(this);\n          this.ctx.parent = this.parent.ctx;\n          this.parent.ctx.children.push(this.ctx);\n        }\n      }\n\n      async run() {\n        if (this.ctx._destroyed) return this;\n        if (!this.url) {\n          this.ctx.state = \"error\";\n          if (this.manager.config.debug) this.manager.log(\"intent run: no url\");\n          return this;\n        }\n        this.ctx.state = \"loading\";\n        if (this.manager.config.debug) this.manager.log(\"intent run\", this.url);\n\n        try {\n          const url = this.manager._resolveUrl(this.url);\n          const htmlText = await this.ctx.requestText(url, this.manager.config.fetchOptions || {});\n          if (htmlText == null) return this;\n          const { fragment, init } = this.manager._parseHtml(htmlText, this);\n          this.hostEl = fragment.cloneNode(true);\n          console.log(\"hostEl\",this.hostEl);\n          //document.body.appendChild(this.hostEl);\n          this.ctx.state = \"init\";\n          if (typeof init === \"function\") {\n            await init(this, this.data);\n          }\n          this.ctx.ready = true;\n          this.ctx.state = \"ready\";\n        } catch (e) {\n          this.ctx.state = \"error\";\n          if (this.manager.config.debug) this.manager.log(\"intent run error\", this.url, e);\n        }\n        return this;\n      }\n\n      destroy() {\n        const kids = this.children.slice();\n        this.children = [];\n        for (const ch of kids) {\n          try {\n            if (ch && typeof ch.destroy === \"function\") ch.destroy();\n          } catch (_) {}\n        }\n        try {\n          this.ctx.destroy();\n        } catch (_) {}\n        if (this.parent && this.parent.children) {\n          const i = this.parent.children.indexOf(this);\n          if (i !== -1) this.parent.children.splice(i, 1);\n        }\n      }\n    }\n\n    // ----------------------------\n    // HashRouter (optional)\n    // ----------------------------\n    class HashRouter {\n      constructor(manager) {\n        this.manager = manager;\n        this._started = false;\n        this._handler = null;\n        this.routes = []; // [{ pattern, keys, regex, url }]\n        this.outlet = null;\n        this.notFound = null;\n      }\n  \n      // \"#/users/:id\" -> regex + keys\n      _compile(pattern) {\n        const keys = [];\n        let rx = \"^\" + pattern.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n        rx = rx.replace(/\\\\:([a-zA-Z0-9_]+)/g, (_, k) => {\n          keys.push(k);\n          return \"([^/]+)\";\n        });\n        rx += \"$\";\n        return { regex: new RegExp(rx), keys };\n      }\n  \n      configure({ outlet = \"#app\", routes = {}, notFound = null } = {}) {\n        this.outlet = outlet;\n        this.notFound = notFound;\n        this.routes = [];\n  \n        // accept object map or array\n        if (Array.isArray(routes)) {\n          routes.forEach((r) => this.add(r.path, r.url));\n        } else {\n          Object.entries(routes).forEach(([path, url]) => this.add(path, url));\n        }\n        return this;\n      }\n  \n      add(pathPattern, url) {\n        const c = this._compile(pathPattern);\n        this.routes.push({ pattern: pathPattern, keys: c.keys, regex: c.regex, url });\n        return this;\n      }\n  \n      match(hash) {\n        for (const r of this.routes) {\n          const m = r.regex.exec(hash);\n          if (!m) continue;\n          const params = {};\n          r.keys.forEach((k, i) => (params[k] = m[i + 1]));\n          return { url: r.url, route: { hash, params } };\n        }\n        return null;\n      }\n  \n      start() {\n        if (this._started) return;\n        this._started = true;\n  \n        this._handler = () => {\n          const hash = global.location.hash || \"#/\";\n          const match = this.match(hash);\n  \n          const outletEl = normalizeHost(this.outlet);\n          // replace root component on route change\n          if (!match) {\n            if (this.notFound) {\n              this.manager.mount(outletEl, {\n                url: this.notFound,\n                data: { route: { hash, params: {} } },\n                replace: true,\n                parent: null,\n              });\n            }\n            return;\n          }\n  \n          this.manager.mount(outletEl, {\n            url: match.url,\n            data: { route: match.route },\n            replace: true,\n            parent: null,\n          });\n        };\n  \n        global.addEventListener(\"hashchange\", this._handler);\n        global.addEventListener(\"load\", this._handler);\n        this._handler();\n      }\n  \n      stop() {\n        if (!this._started) return;\n        this._started = false;\n        if (this._handler) {\n          global.removeEventListener(\"hashchange\", this._handler);\n          global.removeEventListener(\"load\", this._handler);\n        }\n        this._handler = null;\n      }\n  \n      navigate(hash) {\n        global.location.hash = hash;\n      }\n    }\n  \n    // ----------------------------\n    // Komponentor (manager / API)\n    // ----------------------------\n    class Komponentor {\n      constructor(config = {}) {\n        this.config = Object.assign(\n          {\n            debug: false,\n            baseUrl: null,\n            // overlay:\n            overlayClass: \"komponent-overlay\",\n            overlayHtml:\n              \"<div style='position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)'>Loading</div>\",\n            // scan:\n            markerAttr: \"data-komponent\",\n            // error rendering:\n            errorHtml: (url, err) =>\n              `<div style=\"padding:8px;border:1px solid #c00;background:#fee\">Failed to load <b>${url}</b></div>`,\n          },\n          config\n        );\n  \n        this._root = null;    // Komponent\n        this._rootCtx = null; // Context (for root bus convenience)\n  \n        this.router = new HashRouter(this);\n  \n        // overlay service\n        this.overlay = {\n          show: (k) => this._overlayShow(k),\n          hide: (k) => this._overlayHide(k),\n        };\n      }\n  \n      log(...args) {\n        if (this.config.debug) console.log(\"[komponentor]\", ...args);\n      }\n  \n      _normalizeOpts(opts) {\n        if (typeof opts === \"string\") {\n          return { url: opts, data: {}, replace: false, autoload: true, overlay: true };\n        }\n        if (!isPlainObject(opts)) {\n          return { url: \"\", data: {}, replace: false, autoload: true, overlay: true };\n        }\n        const o = Object.assign(\n          {\n            url: \"\",\n            data: {},\n            replace: false,\n            autoload: true,  // default: scan data-komponent children after mount\n            overlay: true,\n            parent: null,\n          },\n          opts\n        );\n        // allow \"url|x=1|y=2\" in url field too\n        if (typeof o.url === \"string\" && o.url.includes(\"|\")) {\n          const parsed = parseSpec(o.url);\n          o.url = parsed.url;\n          o.data = Object.assign({}, parsed.data, o.data || {});\n        }\n        return o;\n      }\n\n      /** Intent opts only: url + data from spec and programmatic. No DOM/dataset. urlSpecData < programmaticData. */\n      _normalizeIntentOpts(urlOrOpts) {\n        let url = \"\";\n        let data = {};\n        let parent = null;\n        if (typeof urlOrOpts === \"string\") {\n          const parsed = parseSpec(urlOrOpts);\n          url = parsed.url;\n          data = Object.assign({}, parsed.data);\n        } else if (isPlainObject(urlOrOpts)) {\n          const o = urlOrOpts;\n          url = o.url || \"\";\n          const fromUrl = url && url.includes(\"|\") ? parseSpec(url).data : {};\n          data = Object.assign({}, fromUrl, o.data || {});\n          parent = o.parent != null ? o.parent : null;\n        }\n        return { url, data, parent };\n      }\n  \n      _resolveUrl(url) {\n        if (!url) return url;\n        if (this.config.baseUrl && url[0] === \"/\") return this.config.baseUrl + url;\n        return url;\n      }\n  \n      // parse HTML string into DOM fragment + init function (scoped, no global pollution)\n      _parseHtml(htmlText, komponent) {\n        // Put into template, strip <script>, keep scripts text, return fragment\n        const t = document.createElement(\"template\");\n        t.innerHTML = String(htmlText);\n  \n        const scripts = Array.from(t.content.querySelectorAll(\"script\"));\n        const code = scripts.map((s) => s.textContent || \"\").join(\"\\n\");\n        scripts.forEach((s) => s.remove());\n  \n        const fragment = t.content; // DocumentFragment\n  \n        // init extraction:\n        // Convention: scripts may define function init_komponent(k, data) { ... }\n        // We execute scripts in an isolated scope and then grab init_komponent if defined.\n        let init = null;\n        if (code.trim()) {\n          try {\n            // NOTE: This runs arbitrary code from fetched HTML. That's your current model.\n            // Keep it isolated (no global init function).\n            const fn = new Function(\n              \"komponent\",\n              \"data\",\n              \"komponentor\",\n              `\n              \"use strict\";\n              ${code}\n              // if code declared function init_komponent, it will overwrite our local binding only if it was declared as var/let assignment.\n              // to support \"function init_komponent(...) {}\", we detect it via Function constructor scope:\n              return (typeof init_komponent === \"function\") ? init_komponent : null;\n            `\n            );\n            // run once to obtain init function; then call later\n            const maybe = fn(komponent, komponent.data, this);\n            if (typeof maybe === \"function\") init = maybe;\n          } catch (e) {\n            if (this.config.debug) this.log(\"init parse error\", e);\n          }\n        }\n        return { fragment, init };\n      }\n  \n      _renderIntoHost(komponent, fragment) {\n        const host = komponent.hostEl;\n        // clear owned content\n        host.innerHTML = \"\";\n        // append fragment nodes\n        host.appendChild(fragment.cloneNode(true));\n      }\n  \n      _renderError(komponent, err) {\n        try {\n          komponent.hostEl.innerHTML = this.config.errorHtml(komponent.url, err);\n        } catch (_) {}\n      }\n  \n      _overlayShow(k) {\n        const host = k.hostEl;\n        if (!host) return;\n  \n        // If host isn't positioned, overlay absolute positioning is messy; simplest:\n        // create overlay as first child with position:relative wrapper.\n        // Minimal, predictable.\n        // You can replace this later with a better overlay implementation.\n  \n        // avoid duplicate overlay\n        if (k._overlayEl && k._overlayEl.parentNode) return;\n  \n        const ov = document.createElement(\"div\");\n        ov.className = this.config.overlayClass;\n        ov.innerHTML = this.config.overlayHtml;\n  \n        ov.style.position = \"relative\";\n        ov.style.minHeight = \"30px\";\n        ov.style.border = \"1px dashed silver\";\n        ov.style.background = \"#eee\";\n        ov.style.zIndex = \"999999\";\n  \n        k._overlayEl = ov;\n        host.insertBefore(ov, host.firstChild);\n      }\n  \n      _overlayHide(k) {\n        const ov = k._overlayEl;\n        if (ov && ov.parentNode) ov.parentNode.removeChild(ov);\n        k._overlayEl = null;\n      }\n  \n      // ---------- Public API ----------\n      root(host, urlOrOpts) {\n        const el = normalizeHost(host);\n        // destroy existing root if any\n        if (this._root) {\n          try {\n            this._root.destroy();\n          } catch (_) {}\n          this._root = null;\n          this._rootCtx = null;\n        }\n        const k = this.mount(el, Object.assign({}, this._normalizeOpts(urlOrOpts), { replace: true, parent: null }));\n        this._root = k;\n        this._rootCtx = k && k.ctx ? k.ctx : null;\n        return k;\n      }\n  \n      mount(host, urlOrOpts) {\n        const el = normalizeHost(host);\n        const opts = this._normalizeOpts(urlOrOpts);\n  \n        // policy requested by you:\n        // - if mounting onto a host that already has a component, destroy first\n        const existing = getInst(el);\n        \n        if (existing && existing instanceof Komponent && opts.replace) existing.destroy();\n        if (existing && !opts.replace) return existing;\n  \n        // create new component\n        const k = new Komponent(this, el, opts);\n  \n        // run mount async (fire-and-forget); user can await if they want:\n        // return k.mount() would change API; so keep instance return and let user await k.mount() optionally.\n        k.mount();\n  \n        return k;\n      }\n  \n      scan(container = document.body, { parent = null, replaceExisting = false } = {}) {\n        const root = normalizeHost(container);\n        const attr = this.config.markerAttr;\n\n        const nodes = Array.from(root.querySelectorAll(`[${attr}]`));\n        for (const node of nodes) {\n          const spec = node.getAttribute(attr) || \"\";\n          const parsed = parseSpec(spec);\n          const dataFromAttrs = getDataAttributesFromElement(node, attr);\n          const data = Object.assign({}, parsed.data, dataFromAttrs);\n\n          const existing = getInst(node);\n          if (existing && !replaceExisting) continue;\n\n          if (existing && replaceExisting) {\n            try {\n              existing.destroy();\n            } catch (_) {}\n          }\n\n          this.mount(node, {\n            url: parsed.url,\n            data,\n            parent: parent,\n            replace: true,\n          });\n        }\n      }\n  \n      route({ outlet = \"#app\", routes = {}, notFound = null } = {}) {\n        this.router.configure({ outlet, routes, notFound }).start();\n      }\n  \n      navigate(hash) {\n        this.router.navigate(hash);\n      }\n\n      /** Fluent intent builder. .data(objOrKey, val).send({ parent }) -> Intent (after run). */\n      intent(urlOrOpts) {\n        const manager = this;\n        const opts = manager._normalizeIntentOpts(urlOrOpts);\n        let _url = opts.url;\n        let _data = Object.assign({}, opts.data);\n        return {\n          data(objOrKey, val) {\n            console.log(\"data\",objOrKey, val);\n            if (objOrKey != null && typeof objOrKey === \"object\") {\n              console.log(\"objOrKey\",objOrKey);\n              Object.assign(_data, objOrKey);\n            } else if (objOrKey != null) {\n              _data[objOrKey] = val;\n            }\n            return this;\n          },\n          async send({ parent } = {}) {\n            const intent = new Intent(manager, { url: _url, data: _data, parent });\n            await intent.run();\n            return intent;\n          },\n        };\n      }\n\n      /** Convenience: runIntent(url, data, { parent }) -> Intent (after run). */\n      async runIntent(url, data, { parent } = {}) {\n        const opts = this._normalizeIntentOpts({ url, data });\n        const intent = new Intent(this, { url: opts.url, data: opts.data, parent });\n        await intent.run();\n        return intent;\n      }\n    }\n  \n    // ----------------------------\n    // expose namespace\n    // ----------------------------\n    const K = global.komponentor = global.komponentor || {};\n    // If user already has an instance, keep it; else create default instance\n    if (!(K instanceof Komponentor)) {\n      const inst = new Komponentor(K && isPlainObject(K) ? K : {});\n      // copy instance onto global\n      global.komponentor = inst;\n    }\n  \n    // also expose classes for power users\n    global.komponentor.Komponentor = Komponentor;\n    global.komponentor.Komponent = Komponent;\n    global.komponentor.Context = Context;\n    global.komponentor.HashRouter = HashRouter;\n    global.komponentor.Intent = Intent;\n  \n  })(window);\n  "]}