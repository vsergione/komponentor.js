{
  "version": 3,
  "sources": ["../src/ksimpleviews.js"],
  "sourcesContent": ["/**\n * KSimpleViews - KModel + KView with template rendering.\n * Requires: jQuery.\n * Optional: Handlebars (window.Handlebars) for full syntax; otherwise uses built-in {{key}} / {{key.sub}} fallback.\n * No Komponentor dependency.\n */\n(function (root, $) {\n    \"use strict\";\n\n    if (!$ || typeof $.fn !== \"object\") {\n        throw new Error(\"KSimpleViews requires jQuery\");\n    }\n\n    const Handlebars = root.Handlebars;\n\n    /** Fallback when Handlebars is missing: {{key}} and {{key.sub}} only. */\n    function defaultCompile(html) {\n        return function (data) {\n            if (data == null) data = {};\n            return String(html).replace(/\\{\\{(\\w+(?:\\.\\w+)*)\\}\\}/g, (_, path) => {\n                const parts = path.split(\".\");\n                let v = data;\n                for (const p of parts) {\n                    v = v != null && typeof v === \"object\" ? v[p] : undefined;\n                }\n                return v != null ? String(v) : \"\";\n            });\n        };\n    }\n\n    function compileTemplate(html) {\n        if (Handlebars && typeof Handlebars.compile === \"function\") {\n            return Handlebars.compile(html);\n        }\n        return defaultCompile(html);\n    }\n    class KView {\n        #compiled;\n        #model;\n        #el;\n        #destroyed = false;\n\n        /**\n         * @param {jQuery|HTMLElement|string} el - Single element: mount point; its outerHTML is the template. Replaced by the rendered root on first render.\n         * @param {KModel} model - KModel instance.\n         * @param {Object} [lifecycle] - Optional object with onDestroy(fn); if provided, view.destroy() is called when lifecycle is torn down.\n         * @throws {Error} If el is not a single node.\n         */\n        constructor(el, lifecycle) {\n            const $el = $(el);\n            if ($el.length !== 1) {\n                throw new Error(\"KView: el must be a single node (got \" + $el.length + \")\");\n            }\n            this.#el = $el;\n            this.#compiled = compileTemplate($el[0].outerHTML);\n\n            if (lifecycle && typeof lifecycle.onDestroy === \"function\") {\n                lifecycle.onDestroy(() => this.destroy());\n            }\n        }\n\n        render() {\n            const existingData = this.#el.data(\"komponent\") || null;\n\n            if (this.#destroyed) return;\n            try {\n                const html = this.#compiled(this.#model.props);\n                const $content = $(html);\n\n                this.#el.replaceWith($content);\n                this.#el = $content;\n                this.#el.data(\"model\", this.#model).attr(\"is\",\"kview\");\n//                this.#el.find(\"*\").data(\"model\", this.#model);\n            } catch (e) {\n                const $error = $(\"<div>Error in KView.render</div>\");\n                this.#el.replaceWith($error);\n                this.#el = $error;\n                console.error(\"Error in KView.render\", e);\n            }\n\n            if (existingData != null) {\n                this.#el.data(\"komponent\", existingData);\n            }\n        }\n\n        /**\n         * Current root element(s) in the DOM. Before first render, returns the mount element; after, the rendered root.\n         * @returns {jQuery}\n         */\n        getRoot() {\n            return this.#el || $();\n        }\n\n        setModel(model) {\n            if (this.#destroyed) return;\n            this.#model = model;\n            this.render();\n        }\n\n        /**\n         * Unbind this view from the model and mark as destroyed. Removes the view root from the DOM.\n         */\n        destroy() {\n            if (this.#destroyed) return;\n            this.#destroyed = true;\n            if (this.#model && typeof this.#model.unbindView === \"function\") {\n                this.#model.unbindView(this);\n            }\n            if (this.#el && this.#el.length) this.#el.remove();\n            this.#model = null;\n            this.#el = null;\n        }\n    }\n\n    /**\n     * KModel - Observable data for use with KView.\n     * data / props, update(name, value), bindView(view), unbindView(view), render(), destroy().\n     * Events: \"change\" (after update or data set), \"view:bind\", \"view:unbind\", \"destroy\".\n     */\n    class KModel {\n        views = [];\n        #data = {};\n        #destroyed = false;\n        #listeners = new Map(); // event -> [{ fn, ctx }]\n\n        get props() {\n            return this.#data;\n        }\n\n        get data() {\n            return this.#data;\n        }\n\n        set data(val) {\n            if (this.#destroyed) return;\n            this.#data = val;\n            this._trigger(\"change\", { data: this.#data });\n            this.render();\n        }\n\n        constructor(data) {\n            this.#data = data || {};\n        }\n\n        /**\n         * Subscribe to an event. Events: \"change\", \"view:bind\", \"view:unbind\", \"destroy\".\n         * @param {string} event - Event name.\n         * @param {function} fn - Callback(payload).\n         * @param {*} [ctx] - Optional this for fn.\n         * @returns {KModel} this\n         */\n        on(event, fn, ctx) {\n            if (typeof fn !== \"function\") return this;\n            const arr = this.#listeners.get(event) || [];\n            arr.push({ fn, ctx: ctx || null });\n            this.#listeners.set(event, arr);\n            return this;\n        }\n\n        /**\n         * Unsubscribe from an event.\n         * @param {string} event - Event name.\n         * @param {function} fn - Same function reference as passed to on().\n         * @param {*} [ctx] - Optional context (must match on() to remove).\n         * @returns {KModel} this\n         */\n        off(event, fn, ctx) {\n            const arr = this.#listeners.get(event);\n            if (!arr) return this;\n            this.#listeners.set(\n                event,\n                arr.filter((l) => !(l.fn === fn && (ctx == null || l.ctx === ctx)))\n            );\n            return this;\n        }\n\n        /**\n         * Emit an event to all listeners.\n         * @param {string} event - Event name.\n         * @param {*} payload - Data passed to listeners.\n         * @returns {KModel} this\n         */\n        trigger(event, payload) {\n            const arr = this.#listeners.get(event);\n            if (!arr || !arr.length) return this;\n            for (const l of arr.slice()) {\n                try {\n                    l.fn.call(l.ctx || null, payload);\n                } catch (e) {\n                    console.error(\"KModel event handler error\", event, e);\n                }\n            }\n            return this;\n        }\n\n        _trigger(event, payload) {\n            this.trigger(event, payload);\n        }\n\n        update(name, val) {\n            if (this.#destroyed) return;\n            this.#data[name] = val;\n            this._trigger(\"change\", { name, value: val });\n            this.render();\n        }\n\n        bindView(view) {\n            if (this.#destroyed) return;\n            if (this.views.indexOf(view) === -1) {\n                this.views.push(view);\n                this._trigger(\"view:bind\", { view });\n            }\n            view.setModel(this);\n        }\n\n        unbindView(view) {\n            const i = this.views.indexOf(view);\n            if (i !== -1) {\n                this.views.splice(i, 1);\n                this._trigger(\"view:unbind\", { view });\n            }\n        }\n\n        unbindAllViews() {\n            this.views.length = 0;\n        }\n\n        render() {\n            if (this.#destroyed) return;\n            this.views.forEach((v) => v.render());\n        }\n\n        destroy() {\n            if (this.#destroyed) return;\n            this.#destroyed = true;\n            this._trigger(\"destroy\", { model: this });\n            this.views.forEach((v) => {\n                if (v && typeof v.destroy === \"function\") v.destroy();\n            });\n            this.views.length = 0;\n            this.#listeners.clear();\n            this.#data = {};\n        }\n    }\n\n    root.KModel = KModel;\n    root.KView = KView;\n    root.getKModel = function(el) {\n        return $(el).parents(\"[is=kview]\").data(\"model\");\n    }\n})(typeof window !== \"undefined\" ? window : globalThis, typeof window !== \"undefined\" && window.jQuery);\n"],
  "mappings": "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",
  "names": ["root", "$", "_compiled", "_model", "_el", "_destroyed", "_data", "_listeners", "Handlebars", "defaultCompile", "html", "data", "_", "path", "parts", "v", "p", "compileTemplate", "KView", "el", "lifecycle", "__privateAdd", "$el", "__privateSet", "existingData", "__privateGet", "$content", "e", "$error", "model", "KModel", "__publicField", "val", "event", "fn", "ctx", "arr", "l", "payload", "name", "view", "i"]
}
